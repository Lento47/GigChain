# W-CSAP Environment Configuration - Production Template
# ========================================================
# Copy this to .env and fill in the values
# NEVER commit .env to version control!

# ============================================
# CRITICAL SECURITY SETTINGS (MANDATORY)
# ============================================

# Secret Key - MANDATORY
# Generate with: python -c 'import secrets; print(secrets.token_hex(32))'
# MUST be at least 32 characters (64 recommended for 256-bit security)
W_CSAP_SECRET_KEY=

# Redis URL for encrypted session storage - MANDATORY
# Examples:
#   Local: redis://localhost:6379/0
#   With password: redis://:password@localhost:6379/0
#   Cluster: redis://redis-cluster:6379/0
W_CSAP_REDIS_URL=redis://localhost:6379/0

# ============================================
# ENVIRONMENT SETTINGS
# ============================================

# Environment: production, staging, or development
ENVIRONMENT=production

# ============================================
# HTTPS & TLS SETTINGS (PRODUCTION MANDATORY)
# ============================================

# Require HTTPS for all requests (MANDATORY in production)
W_CSAP_REQUIRE_HTTPS=true

# Require TLS 1.3 minimum (Recommended)
W_CSAP_REQUIRE_TLS_13=true

# ============================================
# TOKEN SETTINGS
# ============================================

# Challenge TTL (seconds) - How long challenge is valid
# Recommended: 300 (5 minutes)
W_CSAP_CHALLENGE_TTL=300

# Access token TTL (seconds) - How long session token is valid
# Recommended: 900 (15 minutes) for high security
W_CSAP_ACCESS_TOKEN_TTL=900

# Refresh token TTL (seconds) - How long refresh token is valid
# Recommended: 86400 (24 hours)
W_CSAP_REFRESH_TTL=86400

# Enable refresh token rotation (Recommended: true)
W_CSAP_REFRESH_TOKEN_ROTATION=true

# ============================================
# DPOP SETTINGS (HIGHLY RECOMMENDED)
# ============================================

# Enable DPoP (Demonstrating Proof-of-Possession)
# This prevents stolen tokens from being used
# MANDATORY for production
W_CSAP_DPOP_ENABLED=true

# DPoP clock skew tolerance (seconds)
W_CSAP_DPOP_CLOCK_SKEW=60

# ============================================
# RATE LIMITING (MANDATORY)
# ============================================

# Enable global rate limiting per wallet
# This prevents distributed brute-force attacks
W_CSAP_GLOBAL_RATE_LIMIT_ENABLED=true

# Rate limit per action per hour
W_CSAP_RATE_LIMIT_CHALLENGE_PER_HOUR=50
W_CSAP_RATE_LIMIT_VERIFY_PER_HOUR=50
W_CSAP_RATE_LIMIT_REFRESH_PER_HOUR=100
W_CSAP_RATE_LIMIT_FAILED_PER_HOUR=10

# Rate limit per action per day
W_CSAP_RATE_LIMIT_CHALLENGE_PER_DAY=200
W_CSAP_RATE_LIMIT_VERIFY_PER_DAY=200
W_CSAP_RATE_LIMIT_REFRESH_PER_DAY=500
W_CSAP_RATE_LIMIT_FAILED_PER_DAY=30

# Lockout settings
W_CSAP_MAX_FAILED_ATTEMPTS=5
W_CSAP_LOCKOUT_DURATION=900  # 15 minutes

# ============================================
# JWT SETTINGS (PHASE 2)
# ============================================

# Use JWT tokens instead of HMAC (Recommended for production)
W_CSAP_USE_JWT_TOKENS=true

# JWT algorithm (ES256 or EdDSA recommended)
W_CSAP_JWT_ALGORITHM=ES256

# Token issuer (your auth server URL)
W_CSAP_TOKEN_ISSUER=https://auth.gigchain.io

# Token audience (your API URL)
W_CSAP_TOKEN_AUDIENCE=https://api.gigchain.io

# ============================================
# SECURITY FEATURES
# ============================================

# Session binding (bind sessions to IP/User-Agent)
# Can cause issues with mobile networks (IP changes)
W_CSAP_SESSION_BINDING_ENABLED=false

# Audit logging (MANDATORY for production)
W_CSAP_AUDIT_LOGGING_ENABLED=true

# Token revocation (Recommended: true)
W_CSAP_REVOCATION_ENABLED=true
W_CSAP_REVOCATION_CACHE_TYPE=redis

# ============================================
# ADVANCED SECURITY (PHASE 3)
# ============================================

# Risk scoring and behavioral analysis
W_CSAP_RISK_SCORING_ENABLED=true
W_CSAP_RISK_SCORE_THRESHOLD_BLOCK=70
W_CSAP_RISK_SCORE_THRESHOLD_CHALLENGE=50

# Step-up authentication for high-risk operations
W_CSAP_STEP_UP_ENABLED=true
W_CSAP_STEP_UP_GRACE_PERIOD=300
W_CSAP_STEP_UP_HIGH_VALUE_THRESHOLD=10000.0

# Anomaly detection
W_CSAP_ANOMALY_DETECTION_ENABLED=true

# ============================================
# KMS/HSM SETTINGS (OPTIONAL - MAXIMUM SECURITY)
# ============================================

# Use KMS/HSM for key management
W_CSAP_USE_KMS=false

# KMS provider: aws, vault, gcp, azure, or local
W_CSAP_KMS_PROVIDER=aws

# AWS KMS settings (if using AWS)
# W_CSAP_KMS_KEY_ID=arn:aws:kms:us-east-1:123456789:key/...
# W_CSAP_KMS_REGION=us-east-1
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=

# HashiCorp Vault settings (if using Vault)
# W_CSAP_VAULT_ADDR=https://vault.example.com:8200
# W_CSAP_VAULT_TOKEN=

# Key rotation interval (days)
W_CSAP_KEY_ROTATION_DAYS=90

# ============================================
# DATABASE SETTINGS
# ============================================

# SQLite database path
W_CSAP_DB_PATH=data/w_csap.db

# Database pool size
W_CSAP_DB_POOL_SIZE=5

# ============================================
# CORS SETTINGS
# ============================================

# Allowed CORS origins (comma-separated)
# Example: https://app.gigchain.io,https://admin.gigchain.io
W_CSAP_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173

# ============================================
# MONITORING & ALERTING
# ============================================

# Enable analytics
W_CSAP_ANALYTICS_ENABLED=true

# KMS alert webhook (Slack, PagerDuty, etc.)
# W_CSAP_KMS_ALERT_WEBHOOK=https://hooks.slack.com/services/...

# ============================================
# CLEANUP SETTINGS
# ============================================

# Enable automatic cleanup of expired data
W_CSAP_CLEANUP_ENABLED=true

# Cleanup interval (seconds)
W_CSAP_CLEANUP_INTERVAL_SECONDS=3600

# ============================================
# APPLICATION SETTINGS
# ============================================

# Application name (shown in challenge messages)
W_CSAP_APP_NAME=GigChain.io

# Protocol version
W_CSAP_PROTOCOL_VERSION=3.0.0

# Maximum concurrent sessions per wallet (0 = unlimited)
W_CSAP_MAX_ACTIVE_SESSIONS_PER_WALLET=5

# ============================================
# DEVELOPMENT SETTINGS (NOT FOR PRODUCTION)
# ============================================

# Enable debug mode (NEVER in production)
# DEBUG=false

# Enable API documentation (disable in production)
# ENABLE_DOCS=false

# ============================================
# NOTES
# ============================================

# SECURITY CHECKLIST:
# [ ] W_CSAP_SECRET_KEY is set and at least 64 characters
# [ ] W_CSAP_REDIS_URL is configured and Redis is running
# [ ] W_CSAP_REQUIRE_HTTPS=true in production
# [ ] W_CSAP_DPOP_ENABLED=true for maximum security
# [ ] W_CSAP_GLOBAL_RATE_LIMIT_ENABLED=true
# [ ] Firewall configured (only port 443 exposed)
# [ ] SSL/TLS certificates installed and valid
# [ ] Regular security audits scheduled
# [ ] Incident response plan documented
# [ ] Backup and disaster recovery plan in place

# PERFORMANCE NOTES:
# - Redis should have sufficient memory for session storage
# - Consider Redis persistence (RDB/AOF) for durability
# - Monitor Redis memory usage and set maxmemory policy
# - Use Redis Cluster for high availability

# MONITORING:
# - Monitor rate limit violations
# - Alert on failed authentication spikes
# - Track session creation/validation metrics
# - Monitor Redis health and memory usage
# - Track KMS access patterns (if enabled)
